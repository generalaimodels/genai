<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Neural Frontiers Lab - Pioneering Research on the Path to AGI">
  <meta name="theme-color" content="#6b21a8">

  <title>Neural Frontiers Lab</title>

  <!-- Preload critical fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap"
    rel="stylesheet">

  <!-- KaTeX CSS for math rendering -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">

  <!-- Favicon - Neural Network Icon -->
  <link rel="icon" type="image/svg+xml"
    href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Cdefs%3E%3ClinearGradient id='grad' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' style='stop-color:%236b21a8'/%3E%3Cstop offset='100%25' style='stop-color:%23ec4899'/%3E%3C/linearGradient%3E%3C/defs%3E%3Ccircle cx='50' cy='50' r='45' fill='url(%23grad)'/%3E%3Ccircle cx='50' cy='35' r='8' fill='white' opacity='0.9'/%3E%3Ccircle cx='30' cy='55' r='6' fill='white' opacity='0.7'/%3E%3Ccircle cx='70' cy='55' r='6' fill='white' opacity='0.7'/%3E%3C/svg%3E">

  <!-- Theme initialization (prevent flash) -->
  <script>
    (function () {
      // Neural Frontiers Lab defaults to dark theme
      document.documentElement.setAttribute('data-theme', 'dark');
    })();
  </script>
</head>

<body>
  <!-- React App Root -->
  <div id="app"></div>

  <!-- KaTeX Auto-render -->
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"
    onload="renderMathInDocument()"></script>

  <!-- Mermaid Diagrams -->
  <script type="module">
    import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
    mermaid.initialize({
      startOnLoad: true,
      theme: 'dark',
      themeVariables: {
        primaryColor: '#8b5cf6',
        primaryTextColor: '#e2e8f0',
        primaryBorderColor: '#6366f1',
        lineColor: '#818cf8',
        secondaryColor: '#ec4899',
        tertiaryColor: '#3b82f6',
        background: '#1e1b4b',
        mainBkg: '#1e1b4b',
        nodeBorder: '#8b5cf6',
        clusterBkg: '#312e81',
        clusterBorder: '#6366f1'
      }
    });

    // Re-render mermaid on content update
    window.renderMermaid = () => {
      mermaid.run({ querySelector: '.mermaid' });
    };
  </script>

  <!-- Math Rendering - FIXED: No more blinking loop -->
  <script>
    window.renderMathOnce = function () {
      if (typeof katex === 'undefined') {
        console.log('KaTeX not loaded yet');
        return;
      }

      // Get all math elements
      const mathElements = document.querySelectorAll('.math-inline[data-math], .math-block[data-math]');
      console.log(`Found ${mathElements.length} math elements to render`);

      mathElements.forEach((el, index) => {
        // Skip if already rendered
        if (el.hasAttribute('data-katex-rendered')) return;

        const mathText = el.getAttribute('data-math');
        if (!mathText) return;

        try {
          // Clear element
          el.innerHTML = '';

          // Render with KaTeX
          katex.render(mathText, el, {
            displayMode: el.classList.contains('math-block'),
            throwOnError: false,
            strict: false,
            trust: true
          });

          // Mark as rendered
          el.setAttribute('data-katex-rendered', 'true');
          console.log(`Rendered math ${index + 1}/${mathElements.length}`);
        } catch (e) {
          console.error('Math render error:', e);
          el.textContent = mathText;
        }
      });
    }
  </script>

  <script type="module" src="/src/main.tsx"></script>
</body>

</html>